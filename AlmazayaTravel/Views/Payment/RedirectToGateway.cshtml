@inject Microsoft.Extensions.Logging.ILogger<dynamic> logger
@{
    Layout = null;
    ViewData["Title"] = "Redirecting to Payment Gateway...";
    var paymentUrl = ViewBag.PaymentUrl as string;
    var paymentParams = ViewBag.PaymentParams as Dictionary<string, string>;

    void LogConfigurationError()
    {
        logger.LogError("RedirectToGateway view: PaymentUrl or PaymentParams were missing/invalid.");
    }
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            margin: 0;
            text-align: center;
        }

        .container {
            padding: 30px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 90%;
        }

        h1 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 1rem;
        }

        p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .spinner {
            border: 4px solid #dee2e6;
            border-top: 4px solid #0d6efd;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem auto;
        }

        @@keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        small {
            color: #888;
        }

        form {
            display: none;
        }

        .error-container {
            border: 1px solid #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }

            .error-container h1 {
                color: #721c24;
            }
    </style>
</head>
<body onload="submitPaymentForm()">

    @if (!string.IsNullOrEmpty(paymentUrl) && paymentParams != null && paymentParams.Count > 0)
    {
        <div class="container">
            <h1>@ViewData["Title"]</h1>
            <p>Please wait while we securely redirect you to Al Rajhi Bank's payment page.</p>
            <div class="spinner"></div>
            <p><small>Do not close or refresh this window.</small></p>
        </div>

        <form id="paymentForm" action="@paymentUrl" method="POST">
            @foreach (var param in paymentParams)
            {
                <input type="hidden" name="@param.Key" value="@param.Value" />
            }
            <noscript>
                <div class="container error-container">
                    <h1>JavaScript Required</h1>
                    <p>Please enable JavaScript or click the button below to proceed.</p>
                    <button type="submit" style="padding: 10px 20px; font-size: 1rem; cursor: pointer;">Proceed to Payment Manually</button>
                </div>
            </noscript>
        </form>

        <script>
            function submitPaymentForm() {
                try {
                    var paymentForm = document.getElementById('paymentForm');
                    var paymentUrl = paymentForm ? paymentForm.action : null;
                    if (paymentUrl && paymentUrl !== window.location.href) {
                        console.log("Submitting payment form to: " + paymentUrl);
                        paymentForm.submit();
                    } else {
                        console.error("Payment URL is invalid or missing. Cannot submit form.");
                    }
                } catch (e) {
                    console.error("Error submitting form automatically:", e);
                }
            }
        </script>
    }
    else
    {
        <div class="container error-container">
            <h1>Configuration Error</h1>
            <p>Payment parameters are missing or invalid. Cannot redirect to the payment gateway. Please contact support.</p>
            <p><a href="/" style="color: #0d6efd;">Return to Home Page</a></p>
        </div>
    }
</body>
</html>
