@model IEnumerable<AlmazayaTravel.Models.Booking>
@{
    ViewData["Title"] = "View Customer Bookings";
    Layout = "_AdminLayout";
}

<h1 data-key="ViewBookingsTitle" data-en="View Customer Bookings" data-ar="عرض حجوزات العملاء">View Customer Bookings</h1>
<hr />

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show rounded-3" role="alert">
        <i class="fas fa-check-circle"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="table-responsive shadow-sm rounded-3 mt-4">
    <table class="table table-striped table-hover align-middle admin-table">
        <thead class="table-dark">
            <tr>
                <th><span data-key="BookingId" data-en="Booking ID" data-ar="معرف الحجز">Booking ID</span></th>
                <th><span data-key="PackageName" data-en="Package Name" data-ar="اسم الباقة">Package Name</span></th>
                <th><span data-key="ClientName" data-en="Client Name" data-ar="اسم العميل">Client Name</span></th>
                <th><span data-key="Phone" data-en="Phone" data-ar="الهاتف">Phone</span></th>
                <th><span data-key="Email" data-en="Email" data-ar="البريد">Email</span></th>
                <th><span data-key="Adults" data-en="Adults" data-ar="بالغون">Adults</span></th>
                <th><span data-key="Children" data-en="Children" data-ar="أطفال">Children</span></th>
                <th><span data-key="BookingDate" data-en="Booking Date" data-ar="تاريخ الحجز">Booking Date</span></th>
                <th><span data-key="AmountPaid" data-en="Amount Paid" data-ar="المبلغ المدفوع">Amount Paid</span></th>
                <th><span data-key="PaymentStatus" data-en="Payment Status" data-ar="حالة الدفع">Payment Status</span></th>
                <th style="width: 100px;"><span data-key="Actions" data-en="Actions" data-ar="إجراءات">Actions</span></th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                @foreach (var booking in Model)
                {
                    <tr class="@(booking.PaymentStatus?.ToLower() == "completed" ? "table-light" : (booking.PaymentStatus?.ToLower() == "failed" ? "table-danger opacity-75" : ""))">
                        <td>@booking.Id</td>
                        <td>@(booking.TripPackage?.Name ?? "N/A")</td>
                        <td>@booking.ClientName</td>
                        <td>@booking.PhoneNumber</td>
                        <td>@booking.Email</td>
                        <td>@booking.Adults</td>
                        <td>@booking.Children</td>
                        <td>@booking.BookingDate.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                        <td>@(booking.AmountPaid?.ToString("C") ?? "-")</td>
                        <td>
                            @if (booking.PaymentStatus?.ToLower() == "completed")
                            {
                                <span class="badge bg-success" data-key="Paid" data-en="Paid" data-ar="مدفوع">Paid</span>
                            }
                            else if (booking.PaymentStatus?.ToLower() == "failed")
                            {
                                <span class="badge bg-danger" data-key="Failed" data-en="Failed" data-ar="فشل">Failed</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark" data-key="Pending" data-en="Pending" data-ar="قيد الانتظار">Pending</span>
                            }
                        </td>
                        <td>
                            <a asp-action="BookingDetails" asp-route-id="@booking.Id" class="btn btn-sm btn-outline-info" title="View Details">
                                <i class="fas fa-eye"></i> <span data-key="DetailsBtn" data-en="Details" data-ar="تفاصيل">Details</span>
                            </a>
                            <!-- Add other actions like Cancel Booking if needed -->
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="11" class="text-center text-muted py-4">
                        <i class="fas fa-info-circle me-2"></i> <span data-key="NoBookings" data-en="No customer bookings found." data-ar="لم يتم العثور على حجوزات عملاء.">No customer bookings found.</span>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <!-- Translation handled globally by admin-dashboard.js -->
}
